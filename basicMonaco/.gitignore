Extracted from Xeno's Monaco code
